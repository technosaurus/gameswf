# make configuration for the tu-testbed engine library


# If you haven't set TU_TESTBED_COMPILER, then take a guess at its value
# based on the OSTYPE env variable.
#
# If you want to use a particular compiler; for example gcc-3.0, then
# set the environment variable TU_TESTBED_COMPILER to the compiler
# name.
ifndef TU_TESTBED_COMPILER
	ifndef $(OSTYPE)
		OSTYPE = $(shell uname)
	endif
	OSTYPE := $(patsubst Linux, linux, $(OSTYPE))
	OSTYPE := $(patsubst Darwin, darwin, $(OSTYPE))

	# default to msvc
	TU_TESTBED_COMPILER = msvc

	ifneq (,$(findstring linux, $(OSTYPE)))
		TU_TESTBED_COMPILER = gcc
	endif

	ifneq (,$(findstring darwin, $(OSTYPE)))
		TU_TESTBED_COMPILER = gcc3
	endif
endif


ifeq ($(TU_TESTBED_COMPILER), msvc)

#
# MSVC/Windows options
#


# Uncomment this option if you're saddled with an old version of
# MSVCRT.  Newer versions of MSVCRT's malloc perform about the same as
# dlmalloc.
#USE_DL_MALLOC_FLAG := -DUSE_DL_MALLOC

# MSVC
CC := cl /nologo
AR := lib /NOLOGO
#LINK := link /nologo
LIB_OUT_FLAG := /OUT:
LIB_EXT := lib
LIB_PRE :=
OBJ_EXT := obj
EXE_EXT := .exe
DLL_EXT := dll
SDL_DIR := $(TOP)/../SDL-1.2.5
SDL_INCLUDE := -I "$(SDL_DIR)/include"
SDL_LIBS := winmm.lib dxguid.lib kernel32.lib user32.lib gdi32.lib # winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib
SDL_MIXER_INCLUDE := -I$(TOP)/../SDL_mixer-1.2.5
SDL_MIXER_LIB := $(TOP)/../SDL_mixer-1.2.5/VisualC/Release/SDL_mixer.lib


LIBS := opengl32.lib glu32.lib $(SDL_DIR)/lib/SDLmain.lib $(SDL_DIR)/lib/SDL.lib gdi32.lib oldnames.lib $(SDL_LIBS)
CFLAGS := $(CFLAGS) /MD -GR -GX -DWIN32=1 -D_WIN32=1 $(USE_DL_MALLOC_FLAG) -W3 $(SDL_INCLUDE)
LDFLAGS := /link /NODEFAULTLIB:libc.lib /INCREMENTAL:NO /subsystem:console

LIBPNG_DIR := $(TOP)/../libpng
LIBPNG_INCLUDE := -I$(LIBPNG_DIR)
LIBPNG := $(LIBPNG_DIR)/libpng.$(LIB_EXT)

ZLIB_DIR := $(TOP)/../zlib
ZLIB_INCLUDE := -I$(ZLIB_DIR)
ZLIB := $(ZLIB_DIR)/zlib.$(LIB_EXT)

JPEGLIB_DIR := $(TOP)/../jpeg-6b
JPEGLIB_INCLUDE := -I$(JPEGLIB_DIR)
JPEGLIB := $(JPEGLIB_DIR)/libjpeg.$(LIB_EXT)

ifeq ($(DEBUG),1)
	# msvc debug flags
	CC_DEBUG_FLAGS := -Zi -Od
	LDFLAGS := -Zi $(LDFLAGS) -DEBUG /NODEFAULTLIB:msvcrt.lib msvcrtd.lib
	MAKE_DLL := cl /nologo /LDd
else
	# msvc non-debug flags
	CC_DEBUG_FLAGS := -Ox -DNDEBUG=1
	MAKE_DLL := cl /nologo /LD
endif
endif

ifeq ($(TU_TESTBED_COMPILER), gcc)

# GCC
CC := $(TU_TESTBED_COMPILER)
AR := ar -r
LIB_OUT_FLAG :=
LIB_PRE := lib
LIB_EXT := a
OBJ_EXT := o
EXE_EXT :=
DLL_EXT := so
LIBS := -lSDL -lGL -lGLU -lm
DLL_LIBS := -ldl
SDL_CFLAGS := $(shell sdl-config --cflags)
SDL_LDFLAGS := $(shell sdl-config --libs)
SDL_MIXER_INCLUDE := 
SDL_MIXER_LIB := -lSDL_mixer
CFLAGS := $(CFLAGS) $(SDL_CFLAGS) -fpic -Wall
LDFLAGS := -lGL -lGLU
MAKE_DLL := gcc -shared

# On Unix-like machines, these libraries are usually installed in
# standard locations.

#LIBPNG_DIR := $(TOP)/../libpng
#LIBPNG_INCLUDE := $(LIBPNG_DIR)
LIBPNG := -lpng

#ZLIB_DIR := $(TOP)/../zlib
ZLIB_INCLUDE :=
ZLIB := -lz

#JPEGLIB_DIR := $(TOP)/../jpeg-6b
JPEGLIB_INCLUDE :=
JPEGLIB := -ljpeg

ifeq ($(DEBUG), 1)
	# gcc debug flags
	CC_DEBUG_FLAGS := -g
	LDFLAGS := -g
else
	# gcc non-debug flags
	CC_DEBUG_FLAGS := -O2 -DNDEBUG=1 -ffast-math -fexpensive-optimizations -fomit-frame-pointer
endif

endif # GCC

ifeq ($(TU_TESTBED_COMPILER), gcc3)
# make configuration for the tu-testbed engine library
# use this if compiling for linux

CC := $(TU_TESTBED_COMPILER)
AR := ar -r -s
LIB_OUT_FLAG :=
LIB_PRE := lib
LIB_EXT := a
OBJ_EXT := o
EXE_EXT :=
DLL_EXT := so
LIBS := -lSDL -lm -lstdc++
DLL_LIBS := -ldl
SDL_CFLAGS := $(shell sdl-config --cflags)
SDL_LDFLAGS := $(shell sdl-config --libs)
CFLAGS := $(CFLAGS) $(SDL_CFLAGS) -fPIC -Wall
LDFLAGS := -lstdc++
MAKE_DLL := gcc3 -shared

# On Unix-like machines, these libraries are usually installed in
# standard locations.

LIBPNG_DIR := $(TOP)/../libpng
LIBPNG_INCLUDE := -I$(LIBPNG_DIR)
LIBPNG := $(LIBPNG_DIR)/libpng.$(LIB_EXT)

ZLIB_DIR := $(TOP)/../zlib
ZLIB_INCLUDE := -I$(ZLIB_DIR)
ZLIB := $(ZLIB_DIR)/libz.$(LIB_EXT)

JPEGLIB_DIR := $(TOP)/../jpeg-6b
JPEGLIB_INCLUDE := -I$(JPEGLIB_DIR)
JPEGLIB := $(JPEGLIB_DIR)/libjpeg.$(LIB_EXT)


ifeq ($(DEBUG), 1)
	# gcc debug flags
	CC_DEBUG_FLAGS := -g
	LDFLAGS := -g
else
	# gcc non-debug flags
	CC_DEBUG_FLAGS := -O2 -DNDEBUG=1 -ffast-math -fexpensive-optimizations -fomit-frame-pointer
endif
endif

%.$(OBJ_EXT): %.cpp
	$(CC) -c $< $(CFLAGS)

%.$(OBJ_EXT): %.c
	$(CC) -c $< $(CFLAGS)


BASE_LIB := $(TOP)/base/base.$(LIB_EXT)
GEOMETRY_LIB := $(TOP)/geometry/geometry.$(LIB_EXT)
ENGINE_INCLUDE := -I$(TOP)

# Local Variables:
# mode: Makefile
# End:
